# Content Collections API Reference and more

# Content Collections API Reference

# Content Collections API Reference

**Added in:** `astro@2.0.0`

Content collections offer APIs to configure and query your Markdown or MDX documents in `src/content/`. For features and usage examples, [see our content collections guide](https://docs.astro.build/en/guides/content-collections/).

## Imports fromastro:content

[Section titled “Imports from astro:content”](#imports-from-astrocontent)

```
import {  defineCollection,  getCollection,  getEntry,  getEntries,  reference,  render } from 'astro:content';
```

### defineCollection()

[Section titled “defineCollection()”](#definecollection)

**Type:** `(input: CollectionConfig) => CollectionConfig`

 **Added in:** `astro@2.0.0`

`defineCollection()` is a utility to configure a collection in a `src/content.config.*` file.

 src/content.config.ts

```
import { z, defineCollection } from 'astro:content';import { glob } from 'astro/loaders';
const blog = defineCollection({  loader: glob({ pattern: '**/*.md', base: './src/data/blog' }),  schema: z.object({    title: z.string(),    permalink: z.string().optional(),  }),});
// Expose your defined collection to Astro// with the `collections` exportexport const collections = { blog };
```

This function accepts the following properties:

#### loader

[Section titled “loader”](#loader)

**Type:** `() => Promise<Array<{ id: string, [key: string]: any }> | Record<string, Record<string, any>>> | Loader`

 **Added in:** `astro@5.0.0`

A `loader` is either an object or a function that allows you to load data from any source, local or remote, into content collections.

[See theContent Collectionguide](https://docs.astro.build/en/guides/content-collections/#defining-the-collection-loader) for example usage.

#### schema

[Section titled “schema”](#schema)

**Type:** `ZodType | (context: SchemaContext) => ZodType`

 **Added in:** `astro@2.0.0`

`schema` is an optional Zod object to configure the type and shape of document frontmatter for a collection. Each value must use [a Zod validator](https://docs.astro.build/en/reference/modules/astro-zod/#common-data-type-validators).

[See theContent Collectionguide](https://docs.astro.build/en/guides/content-collections/#defining-the-collection-schema) for example usage.

### reference()

[Section titled “reference()”](#reference)

**Type:** `(collection: string) => ZodEffects<ZodString, { collection, id: string }>`

 **Added in:** `astro@2.5.0`

The `reference()` function is used in the content config to define a relationship, or “reference,” from one collection to another. This accepts a collection name and transforms the reference into an object containing the collection name and the reference id.

This example defines references from a blog author to the `authors` collection and an array of related posts to the same `blog` collection:

```
import { defineCollection, reference, z } from 'astro:content';import { glob, file } from 'astro/loaders';
const blog = defineCollection({  loader: glob({ pattern: '**/*.md', base: './src/data/blog' }),  schema: z.object({    // Reference a single author from the `authors` collection by `id`    author: reference('authors'),    // Reference an array of related posts from the `blog` collection by `slug`    relatedPosts: z.array(reference('blog')),  })});
const authors = defineCollection({  loader: file("src/data/authors.json"),  schema: z.object({ /* ... */ })});
export const collections = { blog, authors };
```

Validation of referenced entries happens at runtime when using `getEntry()` or `getEntries()`:

 src/pages/[posts].astro

```
// if a referenced entry is invalid, this will return undefined.const relatedPosts = await getEntries(blogPost.data.relatedPosts);
```

[See theContent Collectionguide](https://docs.astro.build/en/guides/content-collections/#defining-collection-references) for example usage.

### getCollection()

[Section titled “getCollection()”](#getcollection)

**Type:** `(collection: string, filter?: (entry: CollectionEntry<collection>) => boolean) => CollectionEntry<collection>[]`

 **Added in:** `astro@2.0.0`

`getCollection()` is a function that retrieves a list of content collection entries by collection name.

It returns all items in the collection by default, and accepts an optional `filter` function to narrow by entry properties. This allows you to query for only some items in a collection based on `id` or frontmatter values via the `data` object.

```
---import { getCollection } from 'astro:content';
// Get all `src/content/blog/` entriesconst allBlogPosts = await getCollection('blog');
// Only return posts with `draft: true` in the frontmatterconst draftBlogPosts = await getCollection('blog', ({ data }) => {  return data.draft === true;});---
```

[See theContent Collectionguide](https://docs.astro.build/en/guides/content-collections/#querying-collections) for example usage.

### getEntry()

[Section titled “getEntry()”](#getentry)

**Types:**

- `(collection: string, id: string) => Promise<CollectionEntry<collection> | undefined>`
- `({ collection: string, id: string }) => Promise<CollectionEntry<collection> | undefined>`

 **Added in:** `astro@2.5.0`

`getEntry()` is a function that retrieves a single collection entry by collection name and the entry `id`. `getEntry()` can also be used to get referenced entries to access the `data` or `body` properties:

```
---import { getEntry } from 'astro:content';
// Get `src/content/blog/enterprise.md`const enterprisePost = await getEntry('blog', 'enterprise');
// Get `src/content/captains/picard.json`const picardProfile = await getEntry('captains', 'picard');
// Get the profile referenced by `data.captain`const enterpriseCaptainProfile = await getEntry(enterprisePost.data.captain);---
```

See the `Content Collections` guide for examples of [querying collection entries](https://docs.astro.build/en/guides/content-collections/#querying-collections).

### getEntries()

[Section titled “getEntries()”](#getentries)

**Type:** `(Array<{ collection: string, id: string }>) => Array<CollectionEntry<collection>>`

 **Added in:** `astro@2.5.0`

`getEntries()` is a function that retrieves multiple collection entries from the same collection. This is useful for [returning an array of referenced entries](https://docs.astro.build/en/guides/content-collections/#defining-collection-references) to access their associated `data` and `body` properties.

```
---import { getEntries, getEntry } from 'astro:content';
const enterprisePost = await getEntry('blog', 'enterprise');
// Get related posts referenced by `data.relatedPosts`const enterpriseRelatedPosts = await getEntries(enterprisePost.data.relatedPosts);---
```

### render()

[Section titled “render()”](#render)

**Type:** `(entry: CollectionEntry) => Promise<RenderedEntry>`

 **Added in:** `astro@5.0.0`

A function to compile a given entry for rendering. This returns the following properties:

- `<Content />` - A component used to render the document’s contents in an Astro file.
- `headings` - A generated list of headings, [mirroring Astro’sgetHeadings()utility](https://docs.astro.build/en/guides/markdown-content/#available-properties) on Markdown and MDX imports.
- `remarkPluginFrontmatter ` - The modified frontmatter object after any [remark or rehype plugins have been applied](https://docs.astro.build/en/guides/markdown-content/#modifying-frontmatter-programmatically). Set to type `any`.

```
---import { getEntry, render } from 'astro:content';const entry = await getEntry('blog', 'entry-1');
if (!entry) {   // Handle Error, for example:  throw new Error('Could not find blog post 1');}const { Content, headings, remarkPluginFrontmatter } = await render(entry);---
```

[See theContent Collectionguide](https://docs.astro.build/en/guides/content-collections/#rendering-body-content) for example usage.

## astro:contenttypes

[Section titled “astro:content types”](#astrocontent-types)

```
import type {  CollectionEntry,  CollectionKey,  ContentCollectionKey,  DataCollectionKey,  SchemaContext, } from 'astro:content';
```

### CollectionEntry

[Section titled “CollectionEntry”](#collectionentry)

Query functions including [getCollection()](#getcollection), [getEntry()](#getentry), and [getEntries()](#getentries) each return entries with the `CollectionEntry` type. This type is available as a utility from `astro:content`:

```
import type { CollectionEntry } from 'astro:content';
```

`CollectionEntry` is a generic type. Use it with the name of the collection you’re querying.
For example, an entry in your `blog` collection would have the type `CollectionEntry<'blog'>`.

Each `CollectionEntry` is an object with the following values:

#### id

[Section titled “id”](#id)

**Type:** `string`

A unique ID. Note that all IDs from Astro’s built-in `glob()` loader are slugified.

#### collection

[Section titled “collection”](#collection)

**Example Type:** `'blog' | 'authors' | ...`

The name of a collection in which entries are located. This is the name used to reference the collection in your schema, and in querying functions.

#### data

[Section titled “data”](#data)

**Type:** `CollectionSchema<TCollectionName>`

An object of frontmatter properties inferred from your collection schema ([seedefineCollection()reference](#definecollection)). Defaults to `any` if no schema is configured.

#### body

[Section titled “body”](#body)

**Type:** `string | undefined`

A string containing the raw, uncompiled body of the Markdown or MDX document.

Note that if [retainBody](https://docs.astro.build/en/reference/content-loader-reference/#retainbody) is set to `false`, this value will be `undefined` instead of containing the raw file contents.

### CollectionKey

[Section titled “CollectionKey”](#collectionkey)

**Added in:** `astro@3.1.0`

A string union of all collection names defined in your `src/content.config.*` file. This type can be useful when defining a generic function wrapping the built-in `getCollection()`.

```
import { type CollectionKey, getCollection } from 'astro:content';
async function queryCollection(collection: CollectionKey) {  return getCollection(collection, ({ data }) => {    return data.draft !== true;  });}
```

### SchemaContext

[Section titled “SchemaContext”](#schemacontext)

The `context` object that `defineCollection` uses for the function shape of `schema`. This type can be useful when building reusable schemas for multiple collections.

This includes the following property:

- `image` - The `image()` schema helper that allows you [to use local images in Content Collections](https://docs.astro.build/en/guides/images/#images-in-content-collections)

```
import { defineCollection, z, type SchemaContext } from "astro:content";
export const imageSchema = ({ image }: SchemaContext) =>    z.object({        image: image(),        description: z.string().optional(),    });
const blog = defineCollection({  loader: /* ... */,  schema: ({ image }) => z.object({    title: z.string(),    permalink: z.string().optional(),    image: imageSchema({ image })  }),});
```

 Reference     [Contribute](https://docs.astro.build/en/contribute/) [Community](https://astro.build/chat) [Sponsor](https://opencollective.com/astrodotbuild)

---

# Environment Variables API Reference

# Environment Variables API Reference

**Added in:** `astro@5.0.0`

The `astro:env` API lets you configure a type-safe schema for environment variables you have set. This allows you to indicate whether they should be available on the server or the client, and define their data type and additional properties. For examples and usage instructions, [see theastro:envguide](https://docs.astro.build/en/guides/environment-variables/#type-safe-environment-variables).

## Imports fromastro:env

[Section titled “Imports from astro:env”](#imports-from-astroenv)

```
import {  getSecret, } from 'astro:env/server';
```

### getSecret()

[Section titled “getSecret()”](#getsecret)

**Added in:** `astro@5.0.0`

The `getSecret()` helper function allows retrieving the raw value of an environment variable by its key.

For example, you can retrieve a boolean value as a string:

```
import {  FEATURE_FLAG, // boolean  getSecret} from 'astro:env/server'
getSecret('FEATURE_FLAG') // string | undefined
```

This can also be useful to get a secret not defined in your schema, for example one that depends on dynamic data from a database or API.

If you need to retrieve environment variables programmatically, we recommend using `getSecret()` instead of `process.env` (or equivalent). Because its implementation is provided by your adapter, you won’t need to update all your calls if you switch adapters. It defaults to `process.env` in dev and build.

 Reference     [Contribute](https://docs.astro.build/en/contribute/) [Community](https://astro.build/chat) [Sponsor](https://opencollective.com/astrodotbuild)

---

# Internationalization API Reference

# Internationalization API Reference

**Added in:** `astro@3.5.0`

This module provides functions to help you create URLs using your project’s configured locales.

Creating routes for your project with the i18n router will depend on certain configuration values you have set that affect your page routes. When creating routes with these functions, be sure to take into account your individual settings for:

- [base](https://docs.astro.build/en/reference/configuration-reference/#base)
- [trailingSlash](https://docs.astro.build/en/reference/configuration-reference/#trailingslash)
- [build.format](https://docs.astro.build/en/reference/configuration-reference/#buildformat)
- [site](https://docs.astro.build/en/reference/configuration-reference/#site)

Also, note that the returned URLs created by these functions for your `defaultLocale` will reflect your `i18n.routing` configuration.

For features and usage examples, [see our i18n routing guide](https://docs.astro.build/en/guides/internationalization/).

## Imports fromastro:i18n

[Section titled “Imports from astro:i18n”](#imports-from-astroi18n)

```
import {  getRelativeLocaleUrl,  getAbsoluteLocaleUrl,  getRelativeLocaleUrlList,  getAbsoluteLocaleUrlList,  getPathByLocale,  getLocaleByPath,  redirectToDefaultLocale,  redirectToFallback,  notFound,  middleware,  requestHasLocale,  normalizeTheLocale,  pathHasLocale,  toCodes,  toPaths } from 'astro:i18n';
```

### getRelativeLocaleUrl()

[Section titled “getRelativeLocaleUrl()”](#getrelativelocaleurl)

**Type:** `(locale: string, path?: string,  options?: GetLocaleOptions) => string`

Use this function to retrieve a relative path for a locale. If the locale doesn’t exist, Astro throws an error.

```
---import { getRelativeLocaleUrl } from 'astro:i18n';
getRelativeLocaleUrl("fr");// returns /fr
getRelativeLocaleUrl("fr", "");// returns /fr/
getRelativeLocaleUrl("fr", "getting-started");// returns /fr/getting-started
getRelativeLocaleUrl("fr_CA", "getting-started", {  prependWith: "blog"});// returns /blog/fr-ca/getting-started
getRelativeLocaleUrl("fr_CA", "getting-started", {  prependWith: "blog",  normalizeLocale: false});// returns /blog/fr_CA/getting-started---
```

### getAbsoluteLocaleUrl()

[Section titled “getAbsoluteLocaleUrl()”](#getabsolutelocaleurl)

**Type:** `(locale: string, path?: string, options?: GetLocaleOptions) => string`

Use this function to retrieve an absolute path for a locale when [`site`] has a value. If [`site`] isn’t configured, the function returns a relative URL. If the locale doesn’t exist, Astro throws an error.

 src/pages/index.astro

```
---import { getAbsoluteLocaleUrl } from 'astro:i18n';
// If `site` is set to be `https://example.com`
getAbsoluteLocaleUrl("fr");// returns https://example.com/fr
getAbsoluteLocaleUrl("fr", "");// returns https://example.com/fr/
getAbsoluteLocaleUrl("fr", "getting-started");// returns https://example.com/fr/getting-started
getAbsoluteLocaleUrl("fr_CA", "getting-started", {  prependWith: "blog"});// returns https://example.com/blog/fr-ca/getting-started
getAbsoluteLocaleUrl("fr_CA", "getting-started", {  prependWith: "blog",  normalizeLocale: false});// returns https://example.com/blog/fr_CA/getting-started---
```

### getRelativeLocaleUrlList()

[Section titled “getRelativeLocaleUrlList()”](#getrelativelocaleurllist)

**Type:** `(path?: string, options?: GetLocaleOptions) => string[]`

Use this like [getRelativeLocaleUrl](#getrelativelocaleurl) to return a list of relative paths for all the locales.

### getAbsoluteLocaleUrlList()

[Section titled “getAbsoluteLocaleUrlList()”](#getabsolutelocaleurllist)

**Type:** `(path?: string, options?: GetLocaleOptions) => string[]`

Use this like [getAbsoluteLocaleUrl](https://docs.astro.build/en/guides/internationalization/#custom-locale-paths) to return a list of absolute paths for all the locales.

### getPathByLocale()

[Section titled “getPathByLocale()”](#getpathbylocale)

**Type:** `(locale: string) => string`

A function that returns the `path` associated to one or more `codes` when [custom locale paths](https://docs.astro.build/en/guides/internationalization/#custom-locale-paths) are configured.

 astro.config.mjs

```
export default defineConfig({  i18n: {    locales: ["es", "en", {      path: "french",      codes: ["fr", "fr-BR", "fr-CA"]    }]  }})
```

 src/pages/index.astro

```
---import { getPathByLocale } from 'astro:i18n';
getPathByLocale("fr"); // returns "french"getPathByLocale("fr-CA"); // returns "french"---
```

### getLocaleByPath()

[Section titled “getLocaleByPath()”](#getlocalebypath)

**Type:** `(path: string) => string`

A function that returns the `code` associated to a locale `path`.

 astro.config.mjs

```
export default defineConfig({  i18n: {    locales: ["es", "en", {      path: "french",      codes: ["fr", "fr-BR", "fr-CA"]    }]  }})
```

 src/pages/index.astro

```
---import { getLocaleByPath } from 'astro:i18n';
getLocaleByPath("french"); // returns "fr" because that's the first code configured---
```

### redirectToDefaultLocale()

[Section titled “redirectToDefaultLocale()”](#redirecttodefaultlocale)

**Type:** `(context: APIContext, statusCode?: ValidRedirectStatus) => Promise<Response>`

 **Added in:** `astro@4.6.0`

A function that returns a `Response` that redirects to the `defaultLocale` configured. It accepts an optional valid redirect status code.

 middleware.js

```
import { defineMiddleware } from "astro:middleware";import { redirectToDefaultLocale } from "astro:i18n";
export const onRequest = defineMiddleware((context, next) => {  if (context.url.pathname.startsWith("/about")) {    return next();  } else {    return redirectToDefaultLocale(context, 302);  }})
```

### redirectToFallback()

[Section titled “redirectToFallback()”](#redirecttofallback)

**Type:** `(context: APIContext, response: Response) => Promise<Response>`

 **Added in:** `astro@4.6.0`

A function that allows you to use your [i18n.fallbackconfiguration](https://docs.astro.build/en/reference/configuration-reference/#i18nfallback) in your own middleware.

 middleware.js

```
import { defineMiddleware } from "astro:middleware";import { redirectToFallback } from "astro:i18n";
export const onRequest = defineMiddleware(async (context, next) => {  const response = await next();  if (response.status >= 300) {    return redirectToFallback(context, response)  }  return response;})
```

### notFound()

[Section titled “notFound()”](#notfound)

**Type:** `(context: APIContext, response?: Response) => Promise<Response> | undefined`

 **Added in:** `astro@4.6.0`

Use this function in your routing middleware to return a 404 when:

- the current path isn’t a root. e.g. `/` or `/<base>`
- the URL doesn’t contain a locale

When a `Response` is passed, the new `Response` emitted by this function will contain the same headers of the original response.

 middleware.js

```
import { defineMiddleware } from "astro:middleware";import { notFound } from "astro:i18n";
export const onRequest = defineMiddleware((context, next) => {  const pathNotFound = notFound(context);  if (pathNotFound) {    return pathNotFound;  }  return next();})
```

### middleware()

[Section titled “middleware()”](#middleware)

**Type:** `(options: { prefixDefaultLocale: boolean, redirectToDefaultLocale: boolean }) => MiddlewareHandler`

 **Added in:** `astro@4.6.0`

A function that allows you to programmatically create the Astro i18n middleware.

This is useful when you still want to use the default i18n logic, but add only a few exceptions to your website.

 middleware.js

```
import { middleware } from "astro:i18n";import { sequence, defineMiddleware } from "astro:middleware";
const customLogic = defineMiddleware(async (context, next) => {  const response = await next();
  // Custom logic after resolving the response.  // It's possible to catch the response coming from Astro i18n middleware.
  return response;});
export const onRequest = sequence(customLogic, middleware({  prefixDefaultLocale: true,  redirectToDefaultLocale: false}))
```

### requestHasLocale()

[Section titled “requestHasLocale()”](#requesthaslocale)

**Type:** `(context: APIContext) => boolean`

 **Added in:** `astro@4.6.0`

Checks whether the current URL contains a configured locale. Internally, this function will use `APIContext#url.pathname`.

 middleware.js

```
import { defineMiddleware } from "astro:middleware";import { requestHasLocale } from "astro:i18n";
export const onRequest = defineMiddleware(async (context, next) => {  if (requestHasLocale(context)) {    return next();  }  return new Response("Not found", { status: 404 });})
```

### normalizeTheLocale()

[Section titled “normalizeTheLocale()”](#normalizethelocale)

**Type:** `(locale: string) => string`

Replaces underscores (`_`) with hyphens (`-`) in the given locale before returning a lowercase version.

 src/pages/index.astro

```
---import { normalizeTheLocale } from "astro:i18n";
normalizeTheLocale("it_VT") // returns `it-vt`// Assuming the current locale is `"pt-PT"`:normalizeTheLocale(Astro.currentLocale) // returns `pt-pt`---
```

### pathHasLocale()

[Section titled “pathHasLocale()”](#pathhaslocale)

**Type:** `(path: string) => boolean`

 **Added in:** `astro@4.6.0`

Checks whether the given path contains a configured locale.

This is useful to prevent errors before using an i18n utility that relies on a locale from a URL path.

 astro.config.mjs

```
export default defineConfig({  i18n: {    locales: [      { codes: ["it-VT", "it"], path: "italiano" },      "es"    ]  }})
```

 src/pages/index.astro

```
---import { pathHasLocale } from "astro:i18n";
pathHasLocale("italiano"); // returns `true`pathHasLocale("es"); // returns `true`pathHasLocale('/es/blog/'); // returns `true`pathHasLocale("it-VT"); // returns `false`---
```

### toCodes()

[Section titled “toCodes()”](#tocodes)

**Type:** `(locales: Locales) => string[]`

 **Added in:** `astro@4.0.0`

Retrieves the configured locale codes for each locale defined in your configuration. When multiple codes are associated to a locale, only the first one will be added to the array.

 astro.config.mjs

```
export default defineConfig({  i18n: {    locales: [      { codes: ["it-VT", "it"], path: "italiano" },      "es"    ]  }})
```

 src/pages/index.astro

```
---import { i18n } from "astro:config/client";import { toCodes } from "astro:i18n";
toCodes(i18n!.locales); // ["it-VT", "es"]---
```

### toPaths()

[Section titled “toPaths()”](#topaths)

**Type:** `(locales: Locales) => string[]`

 **Added in:** `astro@4.0.0`

Retrieves the configured locale paths for each locale defined in your configuration.

 astro.config.mjs

```
export default defineConfig({  i18n: {    locales: [      { codes: ["it-VT", "it"], path: "italiano" },      "es"    ]  }})
```

 src/pages/index.astro

```
---import { i18n } from "astro:config/client";import { toPaths } from "astro:i18n";
toPaths(i18n!.locales); // ["italiano", "es"]---
```

 Reference     [Contribute](https://docs.astro.build/en/contribute/) [Community](https://astro.build/chat) [Sponsor](https://opencollective.com/astrodotbuild)

---

# Middleware API Reference

# Middleware API Reference

**Added in:** `astro@2.6.0`

Middleware allows you to intercept requests and responses and inject behaviors dynamically every time a page or endpoint is about to be rendered. For features and usage examples, [see our middleware guide](https://docs.astro.build/en/guides/middleware/).

## Imports fromastro:middleware

[Section titled “Imports from astro:middleware”](#imports-from-astromiddleware)

The following helpers are imported from the virtual middleware module:

```
import {  defineMiddleware,  sequence,} from 'astro:middleware';
```

### defineMiddleware()

[Section titled “defineMiddleware()”](#definemiddleware)

**Type:** `(fn: MiddlewareHandler) => MiddlewareHandler`

A function for defining a middleware function with type safety. When you use this utility, the [context](#context) and [next()](#next) arguments are automatically typed, and you will get a Typescript error if you try to return a [value not supported in your middleware](#middlewarehandler).

 src/middleware.ts

```
import { defineMiddleware } from "astro:middleware";
export const onRequest = defineMiddleware((context, next) => {  /* your middleware logic */});
```

### sequence()

[Section titled “sequence()”](#sequence)

**Type:** `(…handlers: MiddlewareHandler[]) => MiddlewareHandler`

A function that accepts middleware functions as arguments, and will execute them in the order in which they are passed.

 src/middleware.js

```
import { sequence } from "astro:middleware";
async function validation(context, next) {/* ... */}async function auth(context, next) {/* ... */}async function greeting(context, next) {/* ... */}
export const onRequest = sequence(validation, auth, greeting);
```

## Imports fromastro/middleware

[Section titled “Imports from astro/middleware”](#imports-from-astromiddleware-1)

The following helpers can be imported from the regular middleware module when you build an [Astro Integration](https://docs.astro.build/en/reference/integrations-reference/):

```
import {  createContext,  defineMiddleware,  sequence,  trySerializeLocals,} from "astro/middleware";
```

### createContext()

[Section titled “createContext()”](#createcontext)

**Type:** `(context: CreateContext) => APIContext`

 **Added in:** `astro@2.8.0`

A low-level API to create an [APIContext](https://docs.astro.build/en/reference/api-reference/)to be passed to an Astro middleware [onRequest()function](#onrequest).

This function can be used by integrations/adapters to programmatically execute the Astro middleware.

### defineMiddleware()

[Section titled “defineMiddleware()”](#definemiddleware-1)

See [defineMiddleware()](#definemiddleware) from `astro:middleware`.

### sequence()

[Section titled “sequence()”](#sequence-1)

See [sequence()](#sequence) from `astro:middleware`.

### trySerializeLocals()

[Section titled “trySerializeLocals()”](#tryserializelocals)

**Type:** `(value: unknown) => string`

 **Added in:** `astro@2.8.0`

A low-level API that takes in any value and tries to return a serialized version (a string) of it. If the value cannot be serialized, the function will throw a runtime error.

## astro/middlewaretypes

[Section titled “astro/middleware types”](#astromiddleware-types)

The following types are imported from the regular middleware module:

```
import type {  CreateContext,} from "astro/middleware";
```

### CreateContext

[Section titled “CreateContext”](#createcontext-1)

**Type:** `{ request: Request; params?: Params; userDefinedLocales?: string[]; defaultLocale: string; locals: App.Locals; }`

 **Added in:** `astro@2.8.0`

An object to [create a context](#createcontext) to be passed to an Astro middleware. This contains the following properties:

#### request

[Section titled “request”](#request)

**Type:** `Request`

The incoming [Request](https://developer.mozilla.org/en-US/docs/Web/API/Request) object.

#### params

[Section titled “params”](#params)

**Type:** `Params`

An object containing the optional parameters to be passed to [Astro.params](https://docs.astro.build/en/reference/api-reference/#params).

#### userDefinedLocales

[Section titled “userDefinedLocales”](#userdefinedlocales)

**Type:** `string[]`

 **Added in:** `astro@3.5.0`

A list of supported locales defined in the [user’si18nconfiguration](https://docs.astro.build/en/reference/configuration-reference/#i18nlocales).

#### defaultLocale

[Section titled “defaultLocale”](#defaultlocale)

**Type:** `string`

 **Added in:** `astro@4.16.0`

The default locale defined in the [user’si18nconfiguration](https://docs.astro.build/en/reference/configuration-reference/#i18ndefaultlocale).

#### locals

[Section titled “locals”](#locals)

**Type:** `App.Locals`

 **Added in:** `astro@5.0.0`

An object for storing arbitrary information from a middleware, accessible to the user via [Astro.locals](https://docs.astro.build/en/reference/api-reference/#locals).

   Learn more about [storing data inlocals](https://docs.astro.build/en/guides/middleware/#storing-data-in-contextlocals) with example usage.

## astrotypes

[Section titled “astro types”](#astro-types)

```
import type {  MiddlewareHandler,  MiddlewareNext,  RewritePayload,} from "astro";
```

### MiddlewareHandler

[Section titled “MiddlewareHandler”](#middlewarehandler)

**Type:** `(context: APIContext, next: MiddlewareNext) => Promise<Response> | Response | Promise<void> | void`

Represents an Astro middleware function. Middleware handlers receive two arguments and can either return a `Response` directly or call `next()` to invoke the next middleware in the chain. Alternatively, you can use [defineMiddleware()](#definemiddleware) to get type safety for your middleware.

The following example imports the `MiddlewareHandler` type to get type safety in the [onRequest()](#onrequest) function:

 src/middleware.ts

```
import type { MiddlewareHandler } from "astro";
export const onRequest: MiddlewareHandler = (context, next) => {  /* the middleware logic */};
```

A middleware handler receives the following properties:

#### context

[Section titled “context”](#context)

**Type:** [APIContext](https://docs.astro.build/en/reference/api-reference/)

An [Astro context](https://docs.astro.build/en/reference/api-reference/) object mirroring many of the `Astro` global properties.

#### next()

[Section titled “next()”](#next)

**Type:** [MiddlewareNext](#middlewarenext)

A function that calls all the subsequent middleware in the chain and returns a `Response`. For example, other middleware could modify the HTML body of a response and awaiting the result of `next()` would allow your middleware to respond to those changes.

Since Astro v4.13.0, `next()` accepts an optional URL path parameter in the form of a string, `URL`, or `Request` to [rewrite](https://docs.astro.build/en/guides/routing/#rewrites) the current request without retriggering a new rendering phase.

The following example uses `next()` to serve content from a different path when the current path matches `/old-path`:

 src/middleware.ts

```
import type { MiddlewareHandler } from "astro";
export const onRequest: MiddlewareHandler = (context, next) => {  if (context.url.pathname === '/old-path') {    return next('/new-path');  }  return next();};
```

### MiddlewareNext

[Section titled “MiddlewareNext”](#middlewarenext)

**Type:** `(rewritePayload?: RewritePayload) => Promise<Response>`

Represents the [next()function](#next) passed to middleware handlers.

### RewritePayload

[Section titled “RewritePayload”](#rewritepayload)

**Type:** `string | URL | Request`

 **Added in:** `astro@4.13.0`

Represents the destination for a [rewrite](https://docs.astro.build/en/guides/routing/#rewrites) when passed to the [next()](#next) function.

## Middleware exports

[Section titled “Middleware exports”](#middleware-exports)

When defining your project’s middleware in `src/middleware.js`, export the following user-defined functions:

### onRequest()

[Section titled “onRequest()”](#onrequest)

**Type:** [MiddlewareHandler](#middlewarehandler)

A required exported function from `src/middleware.js` that will be called before rendering every page or API route. It receives two arguments: [context](#context) and [next()](#next). `onRequest()` must return a `Response`: either directly, or by calling `next()`.

 src/middleware.js

```
export function onRequest (context, next) {  // intercept response data from a request  // optionally, transform the response  // return a Response directly, or the result of calling `next()`  return next();};
```

 Reference     [Contribute](https://docs.astro.build/en/contribute/) [Community](https://astro.build/chat) [Sponsor](https://opencollective.com/astrodotbuild)

---

# View Transitions Router API Reference

# View Transitions Router API Reference

**Added in:** `astro@3.0.0`

These modules provide functions to control and interact with the View Transitions API and client-side router.

For features and usage examples, [see our View Transitions guide](https://docs.astro.build/en/guides/view-transitions/).

## Imports fromastro:transitions

[Section titled “Imports from astro:transitions”](#imports-from-astrotransitions)

```
import {  ClientRouter,  fade,  slide,} from 'astro:transitions';
```

### <ClientRouter />

[Section titled “<ClientRouter />”](#clientrouter-)

**Added in:** `astro@5.0.0`

Opt in to using view transitions on individual pages by importing and adding the `<ClientRouter />` routing component to `<head>` on every desired page.

 src/pages/index.astro

```
---import { ClientRouter } from 'astro:transitions';---<html lang="en">  <head>    <title>My Homepage</title>    <ClientRouter />  </head>  <body>    <h1>Welcome to my website!</h1>  </body></html>
```

See more about how to [control the router](https://docs.astro.build/en/guides/view-transitions/#router-control) and [add transition directives](https://docs.astro.build/en/guides/view-transitions/#transition-directives) to page elements and components.

The `<ClientRouter />` component accepts the following props:

#### fallback

**Type:** [Fallback](#fallback)
 **Default:** `animate`

Defines the fallback strategy to use for browsers that do not support the [View Transitions API](https://developer.mozilla.org/en-US/docs/Web/API/View_Transition_API).

### fade

[Section titled “fade”](#fade)

**Type:** `(opts: { duration?: string | number }) => TransitionDirectionalAnimations`

 **Added in:** `astro@3.0.0`

Utility function to support customizing the duration of the built-in `fade` animation.

```
---import { fade } from 'astro:transitions';---
<div transition:animate="fade" />
<div transition:animate={fade({ duration: '0.4s' })} />
```

### slide

[Section titled “slide”](#slide)

**Type:** `(opts: { duration?: string | number }) => TransitionDirectionalAnimations`

 **Added in:** `astro@3.0.0`

Utility function to support customizing the duration of the built-in `slide` animation.

```
---import { slide } from 'astro:transitions';---
<div transition:animate="slide" />
<div transition:animate={slide({ duration: '0.4s' })} />
```

## Imports fromastro:transitions/client

[Section titled “Imports from astro:transitions/client”](#imports-from-astrotransitionsclient)

```
import {  getFallback,  navigate,  supportsViewTransitions,  swapFunctions,  transitionEnabledOnThisPage,  /* The following are scheduled for deprecation in v6: */  isTransitionBeforePreparationEvent,  isTransitionBeforeSwapEvent,  TRANSITION_AFTER_PREPARATION,  TRANSITION_AFTER_SWAP,  TRANSITION_BEFORE_PREPARATION,  TRANSITION_BEFORE_SWAP,  TRANSITION_PAGE_LOAD,} from 'astro:transitions/client';
```

### navigate()

[Section titled “navigate()”](#navigate)

**Type:** `(href: string, options?: Options) => void`

 **Added in:** `astro@3.2.0`

Executes a navigation to the given `href` using the View Transitions API.

This function signature is based on the [navigatefunction from the browser Navigation API](https://developer.mozilla.org/en-US/docs/Web/API/Navigation/navigate). Although based on the Navigation API, this function is implemented on top of the [History API](https://developer.mozilla.org/en-US/docs/Web/API/History_API) to allow for navigation without reloading the page.

`navigate()` does not perform sanitization on the `href` parameter. [Sanitize user input](https://docs.astro.build/en/guides/view-transitions/#navigating-with-user-input) if you use it to determine the URL to navigate to.

#### historyoption

[Section titled “history option”](#history-option)

**Type:** `'auto' | 'push' | 'replace'`
 **Default:** `'auto'`

 **Added in:** `astro@3.2.0`

Defines how this navigation should be added to the browser history.

- `'push'`: the router will use `history.pushState` to create a new entry in the browser history.
- `'replace'`: the router will use `history.replaceState` to update the URL without adding a new entry into navigation.
- `'auto'` (default): the router will attempt `history.pushState`, but if the URL cannot be transitioned to, the current URL will remain with no changes to the browser history.

This option follows the [historyoption](https://developer.mozilla.org/en-US/docs/Web/API/Navigation/navigate#history) from the browser Navigation API but simplified for the cases that can happen on an Astro project.

#### formDataoption

[Section titled “formData option”](#formdata-option)

**Type:** `FormData`

 **Added in:** `astro@3.5.0`

A `FormData` object for `POST` requests.

When this option is provided, the requests to the navigation target page will be sent as a `POST` request with the form data object as the content.

Submitting an HTML form with view transitions enabled will use this method instead of the default navigation with page reload. Calling this method allows triggering the same behavior programmatically.

#### infooption

[Section titled “info option”](#info-option)

**Type:** `any`

 **Added in:** `astro@3.6.0`

Arbitrary data to be included in the `astro:before-preparation` and `astro:before-swap` events caused by this navigation.

This option mimics the [infooption](https://developer.mozilla.org/en-US/docs/Web/API/Navigation/navigate#info) from the browser Navigation API.

#### stateoption

[Section titled “state option”](#state-option)

**Type:** `any`

 **Added in:** `astro@3.6.0`

Arbitrary data to be associated with the `NavigationHistoryEntry` object created by this navigation. This data can then be retrieved using the [history.getStatefunction](https://developer.mozilla.org/en-US/docs/Web/API/NavigationHistoryEntry/getState) from the History API.

This option mimics the [stateoption](https://developer.mozilla.org/en-US/docs/Web/API/Navigation/navigate#state) from the browser Navigation API.

#### sourceElementoption

[Section titled “sourceElement option”](#sourceelement-option)

**Type:** `Element`

 **Added in:** `astro@3.6.0`

The element that triggered this navigation, if any. This element will be available in the following events:

- [astro:before-preparation](#astrobefore-preparation-event)
- [astro:before-swap](#astrobefore-swap-event)

### supportsViewTransitions

[Section titled “supportsViewTransitions”](#supportsviewtransitions)

**Type:** `boolean`

 **Added in:** `astro@3.2.0`

Whether or not view transitions are supported and enabled in the current browser.

### transitionEnabledOnThisPage()

[Section titled “transitionEnabledOnThisPage()”](#transitionenabledonthispage)

**Type:** `() => boolean`

 **Added in:** `astro@3.2.0`

Whether or not the current page has view transitions enabled for client-side navigation. This can be used to make components that behave differently when they are used on pages with view transitions.

### getFallback()

[Section titled “getFallback()”](#getfallback)

**Type:** `() => Fallback`
 **Default:** `animate`

 **Added in:** `astro@3.6.0`

Returns the fallback strategy to use (`animate` by default) in browsers that do not support view transitions.

   See the guide on [Fallback control](https://docs.astro.build/en/guides/view-transitions/#fallback-control) for how to choose and configure the fallback behavior.

### swapFunctions

[Section titled “swapFunctions”](#swapfunctions)

**Type:** `object`

 **Added in:** `astro@4.15.0`

An object containing the utility functions used to build Astro’s default swap function.
These can be useful when [building a custom swap function](https://docs.astro.build/en/guides/view-transitions/#building-a-custom-swap-function).

`swapFunctions` provides the following methods:

#### deselectScripts()

[Section titled “deselectScripts()”](#deselectscripts)

**Type:** `(newDocument: Document) => void`

Marks scripts in the new document that should not be executed. Those scripts are already in the current document and are not flagged for re-execution using [data-astro-rerun](https://docs.astro.build/en/guides/view-transitions/#data-astro-rerun).

#### swapRootAttributes()

[Section titled “swapRootAttributes()”](#swaprootattributes)

**Type:** `(newDocument: Document) => void`

Swaps the attributes between the document roots, like the `lang` attribute. This also includes Astro-injected internal attributes like `data-astro-transition`, which makes the transition direction available to Astro-generated CSS rules.

When making a custom swap function, it is important to call this function so as not to break the view transition’s animations.

#### swapHeadElements()

[Section titled “swapHeadElements()”](#swapheadelements)

**Type:** `(newDocument: Document) => void`

Removes every element from the current document’s `<head>` that is not persisted to the new document. Then appends all new elements from the new document’s `<head>` to the current document’s `<head>`.

#### saveFocus()

[Section titled “saveFocus()”](#savefocus)

**Type:** `() => () => void`

Stores the element in focus on the current page and returns a function that when called, if the focused element was persisted, returns the focus to it.

#### swapBodyElement()

[Section titled “swapBodyElement()”](#swapbodyelement)

**Type:** `(newBody: Element, oldBody: Element) => void`

Replaces the old body with the new body. Then, goes through every element in the old body that should be persisted and have a matching element in the new body and swaps the old element back in place.

### Deprecated imports

[Section titled “Deprecated imports”](#deprecated-imports)

The following imports are scheduled for deprecation in v6. You can still use them in your project, but you may prefer to update your code now.

#### isTransitionBeforePreparationEvent()

**Type:** `(value: any) => boolean`

 **Added in:** `astro@3.6.0`

Determines whether the given value matches a [TransitionBeforePreparationEvent](#transitionbeforepreparationevent). This can be useful when you need to narrow the type of an event in an event listener.

 src/pages/index.astro

```
------
<script>  import {    isTransitionBeforePreparationEvent,    TRANSITION_BEFORE_PREPARATION,  } from "astro:transitions/client";
  function listener(event: Event) {    const setting = isTransitionBeforePreparationEvent(event) ? 1 : 2;    /* do something with setting */  }
  document.addEventListener(TRANSITION_BEFORE_PREPARATION, listener);</script>
```

#### isTransitionBeforeSwapEvent()

**Type:** `(value: any) => boolean`

 **Added in:** `astro@3.6.0`

Determines whether the given value matches a [TransitionBeforeSwapEvent](#transitionbeforeswapevent). This can be useful when you need to narrow the type of an event in an event listener.

 src/pages/index.astro

```
------
<script>  import {    isTransitionBeforeSwapEvent,    TRANSITION_BEFORE_SWAP,  } from "astro:transitions/client";
  function listener(event: Event) {    const setting = isTransitionBeforeSwapEvent(event) ? 1 : 2;    /* do something with setting */  }
  document.addEventListener(TRANSITION_BEFORE_SWAP, listener);</script>
```

#### TRANSITION_BEFORE_PREPARATION

**Type:** `'astro:before-preparation'`

 **Added in:** `astro@3.6.0`

A constant to avoid writing the `astro:before-preparation` event name in plain text when you define an event.

 src/pages/index.astro

```
------
<script>  import { TRANSITION_BEFORE_PREPARATION } from "astro:transitions/client";
  document.addEventListener(TRANSITION_BEFORE_PREPARATION, () => {    /* the listener logic */  });</script>
```

#### TRANSITION_AFTER_PREPARATION

**Type:** `'astro:after-preparation'`

 **Added in:** `astro@3.6.0`

A constant to avoid writing the `astro:after-preparation` event name in plain text when you define an event.

 src/pages/index.astro

```
------
<script>  import { TRANSITION_AFTER_PREPARATION } from "astro:transitions/client";
  document.addEventListener(TRANSITION_AFTER_PREPARATION, () => {    /* the listener logic */  });</script>
```

#### TRANSITION_BEFORE_SWAP

**Type:** `'astro:before-swap'`

 **Added in:** `astro@3.6.0`

A constant to avoid writing the `astro:before-swap` event name in plain text when you define an event.

 src/pages/index.astro

```
------
<script>  import { TRANSITION_BEFORE_SWAP } from "astro:transitions/client";
  document.addEventListener(TRANSITION_BEFORE_SWAP, () => {    /* the listener logic */  });</script>
```

#### TRANSITION_AFTER_SWAP

**Type:** `'astro:after-swap'`

 **Added in:** `astro@3.6.0`

A constant to avoid writing the `astro:after-swap` event name in plain text when you define an event.

 src/pages/index.astro

```
------
<script>  import { TRANSITION_AFTER_SWAP } from "astro:transitions/client";
  document.addEventListener(TRANSITION_AFTER_SWAP, () => {    /* the listener logic */  });</script>
```

#### TRANSITION_PAGE_LOAD

**Type:** `'astro:page-load'`

 **Added in:** `astro@3.6.0`

A constant to avoid writing the `astro:page-load` event name in plain text when you define an event.

 src/pages/index.astro

```
------
<script>  import { TRANSITION_PAGE_LOAD } from "astro:transitions/client";
  document.addEventListener(TRANSITION_PAGE_LOAD, () => {    /* the listener logic */  });</script>
```

## astro:transitions/clienttypes

[Section titled “astro:transitions/client types”](#astrotransitionsclient-types)

```
import type {  Direction,  Fallback,  NavigationTypeString,  Options,  TransitionBeforePreparationEvent,  TransitionBeforeSwapEvent,} from 'astro:transitions/client';
```

### Direction

[Section titled “Direction”](#direction)

**Type:** `'forward' | 'back'`

 **Added in:** `astro@3.2.0`

A union of animation directions:

- `forward`: navigating to the next page in the history or to a new page.
- `back`: navigating to the previous page in the history.

### Fallback

[Section titled “Fallback”](#fallback)

**Type:** `'none' | 'animate' | 'swap'`

 **Added in:** `astro@3.2.0`

A union of fallback strategies to use in browsers that do not support view transitions:

- `animate`: Astro will simulate view transitions using custom attributes before updating page content.
- `swap`: Astro will not attempt to animate the page. Instead, the old page will be immediately replaced by the new one.
- `none`: Astro will not do any animated page transitions at all. Instead, you will get full page navigation in non-supporting browsers.

   Learn more about [controlling the fallback strategy](https://docs.astro.build/en/guides/view-transitions/#fallback-control) with the `ClientRouter`.

### NavigationTypeString

[Section titled “NavigationTypeString”](#navigationtypestring)

**Type:** `'push' | 'replace' | 'traverse'`

 **Added in:** `astro@3.6.0`

A union of supported history navigation events.

### TransitionBeforePreparationEvent

[Section titled “TransitionBeforePreparationEvent”](#transitionbeforepreparationevent)

**Type:** `Event`

 **Added in:** `astro@3.6.0`

Represents an [astro:before-preparationevent](#astrobefore-preparation-event). This can be useful to type the event received by a listener:

 src/pages/index.astro

```
------
<script>  import {    TRANSITION_BEFORE_PREPARATION,    type TransitionBeforePreparationEvent  } from "astro:transitions/client";
  function listener(event: TransitionBeforePreparationEvent) {    /* do something */  }
  document.addEventListener(TRANSITION_BEFORE_PREPARATION, listener);</script>
```

### TransitionBeforeSwapEvent

[Section titled “TransitionBeforeSwapEvent”](#transitionbeforeswapevent)

**Type:** `Event`

 **Added in:** `astro@3.6.0`

Represents an [astro:before-swapevent](#astrobefore-swap-event). This can be useful to type the event received by a listener:

 src/pages/index.astro

```
------
<script>  import {    TRANSITION_BEFORE_SWAP,    type TransitionBeforeSwapEvent  } from "astro:transitions/client";
  function listener(event: TransitionBeforeSwapEvent) {    /* do something */  }
  document.addEventListener(TRANSITION_BEFORE_SWAP, listener);</script>
```

## Lifecycle events

[Section titled “Lifecycle events”](#lifecycle-events)

### astro:before-preparationevent

[Section titled “astro:before-preparation event”](#astrobefore-preparation-event)

**Type:** [TransitionBeforePreparationEvent](#transitionbeforepreparationevent)

 **Added in:** `astro@3.6.0`

An event dispatched at the beginning of a navigation using the View Transitions router. This event happens before any request is made and any browser state is changed.

This event has the attributes:

- [info](#info)
- [sourceElement](#sourceelement)
- [navigationType](#navigationtype)
- [direction](#direction-1)
- [from](#from)
- [to](#to)
- [formData](#formdata)
- [loader()](#loader)

   Read more about how to use this event on the [View Transitions guide](https://docs.astro.build/en/guides/view-transitions/#astrobefore-preparation).

### astro:after-preparationevent

[Section titled “astro:after-preparation event”](#astroafter-preparation-event)

**Type:** `Event`

 **Added in:** `astro@3.6.0`

An event dispatched after the next page in a navigation using View Transitions router is loaded.

This event has no attributes.

   Read more about how to use this event on the [View Transitions guide](https://docs.astro.build/en/guides/view-transitions/#astroafter-preparation).

### astro:before-swapevent

[Section titled “astro:before-swap event”](#astrobefore-swap-event)

**Type:** [TransitionBeforeSwapEvent](#transitionbeforeswapevent)

 **Added in:** `astro@3.6.0`

An event dispatched after the next page is parsed, prepared, and linked into a document in preparation for the transition but before any content is swapped between the documents.

This event can’t be canceled. Calling `preventDefault()` is a no-op.

This event has the attributes:

- [info](#info)
- [sourceElement](#sourceelement)
- [navigationType](#navigationtype)
- [direction](#direction-1)
- [from](#from)
- [to](#to)
- [viewTransition](#viewtransition)
- [swap()](#swap)

   Read more about how to use this event on the [View Transitions guide](https://docs.astro.build/en/guides/view-transitions/#astrobefore-swap).

### astro:after-swapevent

[Section titled “astro:after-swap event”](#astroafter-swap-event)

**Type:** `Event`

An event dispatched after the contents of the page have been swapped but before the view transition ends.

The history entry and scroll position have already been updated when this event is triggered.

### astro:page-loadevent

[Section titled “astro:page-load event”](#astropage-load-event)

**Type:** `Event`

An event dispatched after a page completes loading, whether from a navigation using view transitions or native to the browser.

When view transitions is enabled on the page, code that would normally execute on `DOMContentLoaded` should be changed to execute on this event.

### Lifecycle events attributes

[Section titled “Lifecycle events attributes”](#lifecycle-events-attributes)

**Added in:** `astro@3.6.0`

The following attributes are common to both the [astro:before-preparation](#astrobefore-preparation-event) and [astro:before-swap](#astrobefore-swap-event) events, except for some that are only available with one or the other.

#### info

[Section titled “info”](#info)

**Type:** `any`

Arbitrary data defined during navigation.

This is the literal value passed on the [infooption](#info-option) of the [navigate()function](#navigate).

#### sourceElement

[Section titled “sourceElement”](#sourceelement)

**Type:** `Element | undefined`

The element that triggered the navigation. This can be, for example, an `<a>` element that was clicked.

When using the [navigate()function](#navigate), this will be the element specified in the call.

#### newDocument

[Section titled “newDocument”](#newdocument)

**Type:** `Document`

The document for the next page in the navigation. The contents of this document will be swapped in place of the contents of the current document.

#### navigationType

[Section titled “navigationType”](#navigationtype)

**Type:** [NavigationTypeString](#navigationtypestring)

Which kind of history navigation is happening.

- `push`: a new `NavigationHistoryEntry` is being created for the new page.
- `replace`: the current `NavigationHistoryEntry` is being replaced with an entry for the new page.
- `traverse`: no `NavigationHistoryEntry` is created. The position in the history is changing. The direction of the traversal is given on the [directionattribute](#direction-1).

#### direction

[Section titled “direction”](#direction-1)

**Type:** `string`

The direction of the transition:

- In an [astro:before-preparationevent](#astrobefore-preparation-event), this can be used to define custom directions. The property is writable and accepts any string.
- In an [astro:before-swapevent](#astrobefore-swap-event), this can be used to retrieve the transition direction. The property is readonly and its value can be a predefined [Direction](#direction) or any string that an `astro:before-preparation` event listener might have set.

#### from

[Section titled “from”](#from)

**Type:** `URL`

The URL of the page initiating the navigation.

#### to

[Section titled “to”](#to)

**Type:** `URL`

The URL of the page being navigated to. This property can be modified, the value at the end of the lifecycle will be used in the `NavigationHistoryEntry` for the next page.

#### formData

[Section titled “formData”](#formdata)

**Type:** `FormData | undefined`
 **Available in:** [astro:before-preparationevent](#astrobefore-preparation-event)

When set, a `POST` request will be sent to the [toURL](#to) with the given `FormData` object as the content instead of the normal `GET` request.

When submitting an HTML form with view transitions enabled, this field is automatically set to the data in the form. When using the [navigate()function](#navigate), this value is the same as given in the options.

#### loader()

[Section titled “loader()”](#loader)

**Type:** `() => Promise<void>`
 **Available in:** [astro:before-preparationevent](#astrobefore-preparation-event)

Implementation of the following phase in the navigation (loading the next page). This implementation can be overridden to add extra behavior.

#### viewTransition

[Section titled “viewTransition”](#viewtransition)

**Type:** [ViewTransition](https://developer.mozilla.org/en-US/docs/Web/API/ViewTransition)
 **Available in:** [astro:before-swapevent](#astrobefore-swap-event)

The view transition object used in this navigation. On browsers that do not support the [View Transitions API](https://developer.mozilla.org/en-US/docs/Web/API/View_Transitions_API), this is an object implementing the same API for convenience but without the DOM integration.

#### swap()

[Section titled “swap()”](#swap)

**Type:** `() => void`
 **Available in:** [astro:before-swapevent](#astrobefore-swap-event)

Calls the default document swap logic. By default, this implementation will call the following functions in order:

1. [deselectScripts()](#deselectscripts)
2. [swapRootAttributes()](#swaprootattributes)
3. [swapHeadElements()](#swapheadelements)
4. [saveFocus()](#savefocus)
5. [swapBodyElement()](#swapbodyelement)

   Read more about [building a custom swap function](https://docs.astro.build/en/guides/view-transitions/#building-a-custom-swap-function) in the View Transitions guide.  Reference     [Contribute](https://docs.astro.build/en/contribute/) [Community](https://astro.build/chat) [Sponsor](https://opencollective.com/astrodotbuild)

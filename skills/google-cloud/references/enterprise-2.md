# Deploy your foundation using Terraform downloaded from the consoleStay organized with collectionsSave and categorize content based on your preferences. and more

# Deploy your foundation using Terraform downloaded from the consoleStay organized with collectionsSave and categorize content based on your preferences.

> This page describes how to deploy your foundation using Terraform download from the console.

# Deploy your foundation using Terraform downloaded from the consoleStay organized with collectionsSave and categorize content based on your preferences.

[Google Cloud Setup](https://console.cloud.google.com/cloud-setup) helps administrators configure a
Google Cloud foundation using a [guided flow](https://cloud.google.com/docs/enterprise/cloud-setup), and
deploy directly from the Google Cloud console or download as Terraform.

This document helps you deploy your Google Cloud Setup Terraform file.

## Before you begin

Review [Best practices for using Terraform](https://cloud.google.com/docs/terraform/best-practices-for-terraform), which includes guidelines for effective development with Terraform across team members and workstreams.

If you already deployed the foundation configuration by clicking the Deploy button in the console, and now want to deploy a downloaded Terraform configuration using [your own pipeline](#manage), you must do the following:

- Download the Terraform state file that was generated by the console.
- Include the downloaded state file in your own pipeline process.

For more information, see [Deploy downloaded Terraform after deploying from the console](#deploy-terraform-after-console).

## Deploy Terraform with Cloud Shell

Cloud Shell comes with Terraform pre-installed and pre-authenticated, so you can get
started quickly.

1. From the in-console setup guide, click **Download as Terraform** and save the configuration.
2. Open [Cloud Shell](https://shell.cloud.google.com).
3. In Cloud Shell, create a directory and navigate to it:
  ```
  mkdir cloud-foundation-example && cd cloud-foundation-example
  ```
4. Upload the Terraform configuration that you downloaded in step 1.
  From the Cloud Shell **More** menu,
  select **Upload**, and then click **Choose Files** to select the Terraform configuration.
  Set the destination directory to the folder that you created in the previous step, and then
  click **Upload**.
5. Ensure that you're in the `cloud-foundation-example` directory.
6. Create a Cloud Storage bucket to store [Terraform Remote State](https://cloud.google.com/docs/terraform/resource-management/store-state).
  A remote state lets Terraform use object stores like Cloud Storage to store state
  information about your Terraform-managed infrastructure. This configuration provides
  benefits such as team delegation and state locking.
  To create the Cloud Storage bucket, run the following command:
  ```
  gcloud storage buckets create gs://tf-state-PROJECT_ID
  ```
7. Define a Terraform backend configuration within a `backend.tf` file and replace
  PROJECT_ID to match the project ID that you used in the previous step. For more details,
  review [storing Terraform state in Cloud Storage](https://cloud.google.com/docs/terraform/resource-management/store-state#create_the_bucket).
  ```
  # backend.tf
  terraform {
        backend "gcs" {
          bucket  = "tf-state-PROJECT_ID"
          prefix  = "terraform/state"
        }
  }
  ```
8. Run `terraform init`. This process initializes your working directory that contains
  the Terraform configuration files and the backend.
9. Run `terraform plan` to see the resources Terraform creates. Example output:
  ```
  ...
  Plan: 6 to add, 0 to change, 0 to destroy.
  Note: You didn't use the -out option to save this plan, so Terraform can't
  guarantee to take exactly these actions if you run "terraform apply" now.
  ```
10. Apply the configuration by running `terraform apply`, which deploys your resources to
  Google Cloud. When prompted, enter `yes`.
11. [Explore the Google Cloud console](https://console.cloud.google.com/cloud-resource-manager) to verify that
  your resources are now deployed on your account or project.

## Redeploy Terraform with Cloud Shell

Terraform stores information about deployed resources within the
Terraform state file. If you have followed the previous steps to deploy
your configuration, we strongly recommend that you reuse the same backend
to automatically detect, prune, and update resources defined by the new exported
configuration.

1. From the in-console setup guide, click **Download as Terraform** and
  save the configuration.
2. Open [Cloud Shell](https://shell.cloud.google.com).
3. In Cloud Shell, create a new directory and navigate to it:
  ```
  mkdir cloud-foundation-example-redeploy && cd cloud-foundation-example-redeploy
  ```
4. Upload the Terraform configuration that you downloaded in step 1.
  From the Cloud Shell **More** menu, select
  **Upload**, and then click **Choose Files** to select the Terraform configuration.
  Set the destination directory to the folder that you created in the previous step, and then click **Upload**.
5. Ensure that you're in the `cloud-foundation-example-redeploy` directory.
6. Ensure that the previously created Cloud Storage backend bucket and state file exists.
  ```
  gcloud storage ls gs://tf-state-PROJECT_ID/terraform/state/
  ```
  Example output:
  ```
  gs://tf-state-PROJECT_ID/terraform/state/default.tfstate
  ```
7. Define a Terraform backend configuration within a `backend.tf` file by reusing
  the same bucket and prefix.
  ```
  # backend.tf
  terraform {
        backend "gcs" {
          bucket  = "tf-state-PROJECT_ID"
          prefix  = "terraform/state"
        }
  }
  ```
8. Run `terraform init`. This process initializes your working directory that contains
  the Terraform configuration files and the backend.
9. Run `terraform plan` to see the resources Terraform creates, changes, or destroys.
  Example output:
  ```
  ...
  Plan: 2 to add, 3 to change, 4 to destroy.
  Note: You didn't use the -out option to save this plan, so Terraform can't
  guarantee to take exactly these actions if you run "terraform apply" now.
  ```
10. Apply the configuration by running `terraform apply`, which deploys your resources to
  Google Cloud. When prompted, enter `yes`.
11. [Explore the Google Cloud console](https://console.cloud.google.com/cloud-resource-manager) to verify
  that your resources are now deployed on your account or project.

## Deploy downloaded Terraform after deploying from the console

If you already deployed the foundation configuration using the Deploy button in the console, a Terraform state file was generated. If you now want to download the Terraform configuration to deploy using [your own pipeline](#manage), you must include the Terraform state file that was generated during your console deployment.

To download and use the state file:

1. To download the Terraform state file, complete the following procedures in [Manage the Terraform state file](https://cloud.google.com/infrastructure-manager/docs/state-file):
  1. [Lock the deployment](https://cloud.google.com/infrastructure-manager/docs/state-file#lock_the_deployment).
  2. [Download the state file](https://cloud.google.com/infrastructure-manager/docs/state-file#download_the_state_file).
  3. [Unlock the deployment](https://cloud.google.com/infrastructure-manager/docs/state-file#unlock_the_deployment).
2. To move the state file you downloaded to a Cloud Storage bucket, see [Store Terraform state in a Cloud Storage bucket](https://cloud.google.com/docs/terraform/resource-management/store-state).
3. To redeploy the Terraform configuration, see [Redeploy Terraform with Cloud Shell](#redeploy).

## Troubleshooting Terraform deployments

### Deploy Terraform with existing resources

If the downloaded Terraform configuration attempts to create resources that
already exist, Terraform exits with a
[409error code](https://cloud.google.com/resource-manager/docs/core_errors#CONFLICT).
To resolve these errors, you can delete the resource by using the
Google Cloud console
or gcloud CLI, and then re-apply the Terraform configuration.
Alternatively, if these resources are critical and cannot be deleted, you can
[import resources](https://cloud.google.com/docs/terraform/resource-management/import#manually_importing_resources)
into your Terraform state.

## Manage infrastructure as code with Terraform, Cloud Build, and GitOps

We recommend following this [tutorial](https://cloud.google.com/architecture/managing-infrastructure-as-code) for complete instructions. This option is for platform admins and operators who are looking for a strategy to predictably and repeatedly make changes to infrastructure. The guide assumes that you are familiar with Google Cloud, Linux, and GitHub. The high-level steps of this option are as follows:

1. Set up your GitHub repository.
2. Configure Terraform to store state in a Cloud Storage bucket.
3. Grant permissions to your Cloud Build service account.
4. Connect Cloud Build to your GitHub repository.
5. Change your environment configuration in a feature branch.
6. Promote changes to the development environment.
7. Promote changes to the production environment.

   Was this helpful?

---

# Extend your initial setup and build your architectureStay organized with collectionsSave and categorize content based on your preferences.

# Extend your initial setup and build your architectureStay organized with collectionsSave and categorize content based on your preferences.

After you complete [Google Cloud Setup](https://cloud.google.com/docs/enterprise/cloud-setup), you can
extend your initial configuration and build your architecture.

## Extend your initial setup

Google Cloud Setup helps you create and deploy an initial configuration. To
further customize your configuration to meet your organization's unique needs,
you can perform the following optional procedures at any time after you complete
your initial setup.

### Manage users and groups

To manage users and groups beyond the initial administrators you created, do the
following:

- To manually create additional users and groups, see the following.
  - [Create a group in your organization](https://support.google.com/cloudidentity/answer/33343).
  - [Add or invite users to a group](https://support.google.com/cloudidentity/answer/6191469).
- If you use an identity provider such as Active Directory,
  Azure AD, Okta, or Ping Identity, you can federate your provider into
  Google Cloud. For details see the following:
  - [Reference architectures: using an external IdP](https://cloud.google.com/architecture/identity/reference-architectures#using_an_external_idp).
  - To automatically provision users and enable single sign-on, see [Federate Cloud Identity with Active Directory](https://cloud.google.com/architecture/identity/federating-gcp-with-active-directory-introduction).
  - To sync Active Directory users and groups to Google Cloud, see [Directory Sync](https://support.google.com/a/topic/10343447).
- To automate identity administration tasks, see [Google Workspace Admin SDK](https://developers.google.com/admin-sdk/).

### Monitor your billing account

To monitor costs after you set up your Cloud Billing account, we recommend
that you implement the following for each account:

- For an overview of cost management best practices, see [Cost optimization](https://cloud.google.com/architecture/framework/cost-optimization).
- Export detailed Cloud Billing data (such as usage, cost estimates, and
  pricing data) automatically throughout the day. For more information, see
  [Export Cloud Billing data exports to BigQuery](https://cloud.google.com/billing/docs/how-to/export-data-bigquery).
- Define budgets to generate alerts when spending reaches thresholds. For more
  information, see [Create, edit, or delete budgets and budget alerts](https://cloud.google.com/billing/docs/how-to/budgets).

### Customize your network

After you deploy your configuration, you can customize your initial network
settings by doing the following:

- To create and connect service projects, see [Attach service projects](https://cloud.google.com/vpc/docs/provisioning-shared-vpc#create-shared).
- If you create GKE instances in your projects, configure secondary [IP address ranges for VPC-native clusters](https://cloud.google.com/kubernetes-engine/docs/concepts/alias-ips#cluster_sizing).

### Maintain and analyze logs

After you create your initial logging configuration, do the following:

- To query, view, and analyze logs, see [Query and view logs overview](https://cloud.google.com/logging/docs/log-analytics).
- Cloud Logging includes a free monthly allotment. You might incur
  additional costs as your resource use increases. For more
  information, see [Cloud Logging pricing summary](https://cloud.google.com/stackdriver/pricing#logging-pricing-summary).

### Give users access to support

To configure user access to support services, see [Access control with IAM](https://cloud.google.com/support/docs/access-control).

## Build your Google Cloud architecture

When you are ready to experiment and build your Google Cloud architecture,
see the following:

- To quickly deploy and learn from prebuilt solutions, see [Jump Start Solution guides](https://cloud.google.com/architecture/all-jss-guides).
- To migrate your data and applications from other clouds and on-premises to
  Google Cloud, see [What is Google Cloud Migration Center?](https://cloud.google.com/migration-center/docs/migration-center-overview)
- For workload migration best practices, see [Migrate to Google Cloud](https://cloud.google.com/architecture/migration-to-gcp-getting-started).

   Was this helpful?
